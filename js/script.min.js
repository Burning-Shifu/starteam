"use strict";
document.addEventListener("DOMContentLoaded", function () {
    var e = document.querySelector("body"),
        t = document.querySelector(".header__menu-btn"),
        n = document.querySelector(".header__menu"),
        o = document.querySelectorAll(".header__menu .menu__item");
    t.addEventListener("click", function () {
        return n.classList.toggle("open"), t.classList.toggle("open"), void e.classList.toggle("locked");
    }),
        o.forEach(function (o) {
            o.addEventListener("click", function () {
                return n.classList.remove("open"), t.classList.remove("open"), void e.classList.remove("locked");
            });
        });
    var r = document.querySelector(".development__img"),
        i = document.querySelectorAll(".marketing__block-wrapper");
    function s(e, t, n, o) {
        window.innerWidth <= o ? ((e.src = t), (e.previousSibling.srcset = t)) : ((e.src = n), (e.previousSibling.srcset = n));
    }
    function c(e, t) {
        if (window.innerWidth <= 600) for (var n = 0; n < e.length; n++) n % 2 == 0 ? e[n].classList.add(t) : e[n].classList.remove(t);
        else for (var o = 0; o < e.length; o++) o % 2 == 0 ? e[o].classList.remove(t) : e[o].classList.add(t);
    }
    s(r, "img/content/dev-technologies-mobile.svg", "img/content/dev-technologies.svg", 900),
        c(i, "marketing__block-wrapper--reverse"),
        window.addEventListener("resize", function () {
            s(r, "img/content/dev-technologies-mobile.svg", "img/content/dev-technologies.svg", 900), c(i, "marketing__block-wrapper--reverse");
        });

    // открытие попап при отправке формы

    let popup = document.querySelector('.popup-submit');
    let formSubmit = document.querySelector('.form');
    let formSubmitBtn = document.querySelector('.form__btn--submit');
    let inputs = formSubmit.querySelectorAll('input');
    let textarea = formSubmit.querySelector('textarea');
    let checkbox = formSubmit.querySelector('.form__check-input');
    let popupCloseBtn = document.querySelector('.popup-submit__btn-close');
    let popupThanksBtn = document.querySelector('.popup-submit__btn');

    function showPopup() {
        formSubmit.addEventListener('submit', (e) => {
            e.preventDefault()
            const elements = [...inputs, textarea]
            const obj = {}
            elements.forEach((el) => {
                obj[el.name] = el.value
            })
            sendForm(obj)
            
            popup.style.display = 'block'
            popupCloseBtn.addEventListener('click', () => {
                popup.style.display = 'none'
            })
            popupThanksBtn.addEventListener('click', () => {
                popup.style.display = 'none'
                window.location.href = 'https://t.me/starteam_hr_bot'
            })
            document.addEventListener('keydown', function(e) {
                if (e.key == "Escape") {
                    popup.style.display = 'none'
                }
            });
            setTimeout(() => {
                window.location.href = 'https://t.me/starteam_hr_bot'
            }, 3000)
        })
        // активация кнопки в форме
        function activeBtnSubmit () {
            checkbox.addEventListener('click', () => {
                if (checkbox.checked == true) {
                    formSubmitBtn.classList.add('form__btn')
                    formSubmitBtn.disabled = false           
                } else {
                    formSubmitBtn.classList.remove('form__btn')
                    formSubmitBtn.disabled = true
                }
            })
        }
        activeBtnSubmit()
        
    }
    // отправка данных формы
    async function sendForm(payload) {
        const url = 'https://starteam.io/send.php'
        try {
            const data = await fetch(url, {
                method: 'POST',
                body: JSON.stringify(payload)
            })
        } catch(error) {
            console.error(error)
        }
    }
    showPopup();
});
